function [t,t_ortho,Y_pred] = apply_opls_model(X,Y,model,new_X)
t_ortho = [];

Xres = bsxfun(@minus,new_X,mean(X));
for iter = 1:num_opls_fact
    %run OSC filter on Xres
    t_ortho(:,iter) = Xres*model.w_ortho(:,iter) / (w_ortho(:,iter)'*w_ortho(:,iter));
    Xres = Xres - t_ortho(:,iter)*p_ortho(:,iter)';
end
all_Xres = [all_Xres;Xres];

t = Xres*w/(w'*w);
% Now we have t_ortho and t to use for the plot

