
%Available variables to use.
path = '/Users/zach/Dropbox/BiRG Project/NMR_Peaklist/';
dirListing = dir(path); % Directory listing of the current directory.
molecules = struct('file', '', 'peakNumbers', 0, 'ppm', 0, 'hz', 0,...
    'peakHeight', 0, 'moleculeName', '');
fileCount = length(dirListing) - 2; % How many files are in the directory.
counter = 1;

try
    for i = 1:length(dirListing)
        lineCounter = 0;
        if(dirListing(i).isdir == 1)
            %This is a directory, no need to interact.
            %disp('This is a directory')
        else %Read in file data.
            molecules(counter).file = dirListing(i).name;  
            fid = fopen([path,dirListing(i).name], 'r');
            tline = fgets(fid);
            arrayInc = 1;
            tableTwo = false; %Using this as a "don't use" case for reading table two.

            while(tline ~= -1)
                if(lineCounter == 0) %Commented line of file
                    molName = substring(tline, 13, length(tline) - 19);
                    molecules(counter).moleculeName = molName;
                %Check for "1"
                elseif(~isempty(regexp(tline, '[1-9]')))
                { %Skipping column headers              
                    if(~isempty(regexp(tline,'^\s*\n$')) && lineCounter > 5)
                        break
                    else
                        try
                            peakData = textscan(tline, '%d%f%f%f');

                            molecules(counter).peakNumbers(arrayInc) = peakData{1};
                            molecules(counter).ppm(arrayInc) = peakData{2};
                            molecules(counter).hz(arrayInc) = peakData{3};
                            molecules(counter).peakHeight(arrayInc) = peakData{4};

                            %disp(molecules(counter).peakNumbers(arrayInc))
                            arrayInc = arrayInc +1;
                        catch ME
                            break;
                        end
                    end
                    }% End of Reading
                end %End Comment Check.
                lineCounter = lineCounter + 1;
                tline = fgets(fid);
            end % End of file.
            counter = counter + 1;
            fclose(fid);       
        end
    end
    save('molecules');
    disp('Finished!')
catch ME
    %Something was wrong with a file, unknown character etc.
end